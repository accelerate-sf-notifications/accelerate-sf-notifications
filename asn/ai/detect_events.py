'''
- Gen twitter poster
    - Text
    - Video
- Search API: search event
- Bonus: chat?
    - 
'''


video_transcript_text = '''
00:00:19 >> good afternoon welcome to
00:00:21 tuesday halloween OCTOBER 31,
00:00:23 2023, board of supervisors
00:00:23 meeting.
00:00:26 Could you call the roll?
00:00:28 >> thank you, supervisor chan.
00:00:31 >> present.
00:00:32 Supervisor dorsey.
00:00:32 >> present.
00:00:34 >> supervisor engardio.
00:00:35 >> present.
00:00:37 >> supervisor mandelman.
00:00:38 >> present.
00:00:40 >> supervisor melgar.
00:00:42 >> present.
00:00:44 Supervisor supervisor peskin.
00:00:45 >> present
00:00:46 >> supervisor preston.
00:00:47 >> not present.
00:00:49 >> supervisor ronen.
00:00:50 >> present.
00:00:52 >> supervisor safai.
00:00:53 >> present.
00:00:55 >> supervisor stefani.
00:00:56 >> present.
00:00:58 >> supervisor walton.
00:00:59 >> present.
00:01:01 >> MR. PRESIDENT have you a
00:01:01 quorum.
00:01:02 >> thank you.
00:01:04 San francisco board of
00:01:06 supervisors acknowledges we are
00:01:09 on the unseed home land of the
00:01:10 ramaytush ohlone the original
00:01:12 inhappen tanlts of the san
00:01:13 francisco peninsula.
00:01:17 As stewards of this land and in
00:01:18 accordance with their
00:01:20 instructions ram recommend never
00:01:22 cd, lost nor forgot their
00:01:24 responsibilities as care takers
00:01:28 as well as for all who reside in
00:01:29 their territory.
00:01:31 We benefit from living and
00:01:32 working on their traditional
00:01:33 home land.
00:01:38 We wish to acknowledge the
00:01:41 ancestors, eldand relatives and
00:01:43 affirming their rights as first
00:01:44 peoples.
00:01:47 Join mow in the pledge.
00:02:00 [Pledge of allegiance].
00:02:04 >> colleagues can we have a
00:02:08 motion to excuse supervisor
00:02:09 preston?
00:02:12 And we will take that without
00:02:13 objection.
00:02:14 Supervisor preston is excused.
00:02:16 You have any communications?
00:02:18 >> yes, MR. PRESIDENT the board
00:02:20 away the public to attend this
00:02:22 meet nothing person.
00:02:24 In the legislative chamber in
00:02:26 city hall second floor room 250
00:02:31 this meeting is airing live on
00:02:33 sfgovtv channel 26 or live
00:02:38 stream at www.Sfgov.Org.
00:02:40 You MAY submit comment in
00:02:42 writing in the following ways.
00:02:46 E mail comments to bos add
00:02:48 sfgov.Org if you do submit via e
00:02:50 mail tell be forwarded to the
00:02:51 members and include part of the
00:02:52 official file.
00:02:56 You MAY send written comments
00:03:00 via postal service to the board
00:03:02 of supervisors 1 DR. Carlton b.
00:03:07 Goodlett place room 244, san
00:03:10 francisco, california 94102.
00:03:13 If you need an accommendation
00:03:17 under the ad a contact the
00:03:19 clerk's office.
00:03:21 Our office did not receive a
00:03:23 request for language
00:03:26 interpretation we don't have
00:03:27 interpreters today.
00:03:30 If you anticipate a future need
00:03:32 for language interpretation gift
00:03:34 clerk's office a phone call 48
00:03:37 hours in advance of the meeting
00:03:44 per sunlt to code 691.7.
00:03:45 Thank you, members and MR.
00:03:46 PRESIDENT.
00:03:47 >> thank you are MADAM Clerk.
00:03:50 Can we have a motion to approve
00:03:52 the board meeting minutes of
00:03:54 SEPTEMBER 26, motion by
00:03:56 supervisor mandelman.
00:03:57 Seconded by supervisor walton.
00:04:00 On that motion a roll call.
00:04:03 >> on the minutes supervisor
00:04:04 safai.
00:04:05 >> aye.
00:04:07 >> supervisor stefani.
00:04:08 >> aye.
00:04:11 >> supervisor walton.
00:04:12 >> aye.
00:04:14 >> supervisor chan
00:04:14 >> aye.
00:04:16 >> supervisor dorsey.
00:04:17 >> aye.
00:04:19 >> supervisor engardio.
00:04:20 >> aye.
00:04:22 >> supervisor mandelman.
00:04:23 >> aye.
00:04:25 >> supervisor melgar.
00:04:25 >> aye.
00:04:27 >> supervisor supervisor peskin.
00:04:28 >> aye.
00:04:29 And supervisor ronen.
00:04:30 >> aye.
00:04:33 >> there are 10 aye's.
00:04:36 >> the minutes will be approved
00:04:40 as presented after public
00:04:40 comment.
00:04:42 Could you read the consent
00:04:43 agenda.
00:04:45 >> items 1-8 are on consent
00:04:48 and considered to be routine.
00:04:50 If a member objects an item MAY
00:04:52 be removed and considered
00:04:53 separate low
00:04:55 >> would a members like an item
00:04:56 or items severed?
00:04:58 A roll call.
00:05:01 We will take that same house
00:05:02 same call.
00:05:04 The ordinances are passed on
00:05:06 first reading.
00:05:09 Finally passed and resolutions
00:05:09 adopted.
00:05:11 >> next item.
00:05:14 >> item 9 referred without
00:05:16 recommendation from land use and
00:05:17 transportation.
00:05:19 An ordinance to amend the
00:05:22 planning code to charge zone
00:05:23 nothing castro street
00:05:25 neighborhood commercial to
00:05:28 exclude article 10 inotropics.
00:05:31 Charge the controls change the
00:05:33 zoning controls.
00:05:38 Pursuant to the castro district
00:05:38 neighborhood commercial
00:05:39 district.
00:05:44 Landmark buildings from use size
00:05:46 limitation and night time
00:05:47 entertainment on the second
00:05:50 floor and ceqa and make
00:05:51 appropriate findings.
00:05:56 Roll call?
00:05:56 Item 9.
00:05:56 Supervisor safai.
00:05:57 >> aye.
00:05:59 >> supervisor stefani.
00:06:00 >> aye.
00:06:03 >> supervisor walton.
00:06:04 >> aye.
00:06:05 Supervisor chan.
00:06:06 >> aye.
00:06:08 >> supervisor dorsey.
00:06:09 >> aye.
00:06:11 >> supervisor engardio.
00:06:12 >> aye.
00:06:14 >> supervisor mandelman.
00:06:15 >> aye.
00:06:17 >> supervisor melgar.
00:06:18 >> aye.
00:06:19 >> supervisor supervisor peskin.
00:06:20 >> no.
00:06:22 >> and supervisor ronen.
00:06:24 >> aye.
00:06:29 >> there are 9 aye's and one no
00:06:30 with spries supervisor peskin in
00:06:30 decent.
00:06:32 >> ordinance is passed
00:06:33 >> next item.
00:06:36 >> item 10 an ordinance to amend
00:06:39 the administrative code remove
00:06:41 the authorization for
00:06:43 carbrevolving funds and reduce
00:06:45 the max amount of the cash
00:06:49 revolve
00:06:51 ing fund for the port.
00:06:53 >> supervisor safai.
00:06:53 >> aye
00:06:56 >> supervisor stefani.
00:06:56 >> air
00:06:58 >> supervisor walton.
00:06:59 >> aye
00:07:01 >> supervisor chan
00:07:01 >> aye
00:07:02 >> supervisor dorsey.
00:07:02 >> ayech
00:07:04 >> supervisor engardio.
00:07:05 >> aye.
00:07:07 >> supervisor mandelman.
00:07:08 >> aye.
00:07:10 >> supervisor melgar.
00:07:10 >> aye.
00:07:13 >> supervisor supervisor peskin.
00:07:14 >> aye.
00:07:15 And supervisor ronen.
00:07:16 >> aye.
00:07:18 >> there are 10 aye's.
00:07:20 >> the ordinances are passed.
00:07:21 Next item
00:07:24 >> item 11 is a resolution to
00:07:26 approve the 7th amendment to a
00:07:31 contract the ymc aurban services
00:07:33 truancy resource center.
00:07:35 This is a program between the y
00:07:37 urban service in the city for
00:07:41 not to exceed grant increase of
00:07:41 5.3 million.
00:07:43 One year extension to include a
00:07:47 new term of JULY first, 2013
00:07:49 through JUNE 30 of 2024
00:07:51 >> same house same call.
00:07:52 Next item.
00:07:56 >> item 12 approve the emergency
00:07:59 declaration of the san francisco
00:08:00 puc.
00:08:03 Pursuant to code section 6. 60
00:08:05 contract resources to perform
00:08:07 sewer main, water main and
00:08:10 street repairs on fillmore
00:08:12 between grown and union street
00:08:14 damaged by a water main failure
00:08:16 with an estimated cost not to
00:08:18 exceed 5 million.
00:08:20 >> same house same call it is
00:08:21 adopted.
00:08:21 Next item.
00:08:23 >> item 13.
00:08:25 Resolution to accept a gift of
00:08:27 design documents with an
00:08:30 estimated value of 1.2 million.
00:08:34 From the friends of harvey milk
00:08:37 plaza assist public works in the
00:08:40 redesign and affirm ceqa.
00:08:42 >> same house same call, adopted
00:08:44 >> read 14 and 15 together?
00:08:48 >> yes, 14 and 15 comprise 2
00:08:50 resolutions pertain to the
00:08:52 mission rock facility and
00:08:52 service.
00:08:56 14 authorizes issuance and sale
00:08:59 of special tax bonds for
00:09:03 district 2020-1 near 58.3
00:09:03 million.
00:09:06 To be repaid from development
00:09:07 special tax.
00:09:08 The office special taxes and
00:09:11 shore line taxes levied in tax
00:09:14 zone number 1 of the special tax
00:09:15 district applicable to approve
00:09:18 related documents.
00:09:19 Including official statement and
00:09:22 second supplement to development
00:09:25 special tax agent agreement and
00:09:27 office special tax fiscal agent
00:09:28 agreement.
00:09:30 Shore line tax zone 1 special
00:09:32 tax fiscal agents agreement.
00:09:36 Bond purchase agreement and
00:09:37 continuing disclosure
00:09:39 certificate and rate and method
00:09:43 of the special tax and item 15,
00:09:44 resolution to approve documents
00:09:47 and actions related a pledge
00:09:49 agreement by the city.
00:09:51 Infrastructure district number 2
00:09:53 and development special tax
00:09:56 bonds for ccsf special tax
00:09:58 district 2020-1 and determine
'''

from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate

# TODO make it easier to use
def search_event_from_video(search_item: str, transcript_text: str=video_transcript_text):
    prompt_str = '''Please help me to find the [Search item] from the [Background], find <= 5 items.

Search item:
{search_item}
Background: 
{background}

Please response in json format like:
[
    {{
        "content": "district 2020-1 and determine",
        "time:": 00:09:58",
        "message": "I think they are discussing district."
    }},
    {{
        ...
    }}
    ...
]
'''
    prompt = ChatPromptTemplate.from_template(prompt_str)
    # model = ChatOpenAI()
    model = ChatOpenAI(model='gpt-4', temperature=0.1)
    chain = prompt | model
    res = chain.invoke({
        "background": transcript_text,
        "search_item": search_item
    })
    # import ipdb; ipdb.set_trace()
    print("search_item:", search_item)
    return res.content


def qa_from_video(search_item: str, transcript_text: str=video_transcript_text):
    prompt_str = '''Please help me to answer the questions in [Question], you'll find the answer from [Background]

[Question]:
{search_item}
[Background]: 
{background}

'''
    prompt = ChatPromptTemplate.from_template(prompt_str)
    model = ChatOpenAI(temperature=0.1)
    # model = ChatOpenAI(model='gpt-4')
    chain = prompt | model
    res = chain.invoke({
        "background": transcript_text,
        "search_item": search_item
    })
    # print(res)
    # import ipdb; ipdb.set_trace()
    # print("search_item:", search_item)
    return res.content
    

def gen_tags_from_video(transcript_text: str=video_transcript_text) -> str:
    prompt_str = '''Please help me generate <=10 tags that is the highlight of the video which will be used to search content in the video. Respond in an array.
Thhe tags are:
- Meaningful
- Easy to understand
- 

[Video transcript]: 
{background}

Response:
[?, ?...]
'''
    prompt = ChatPromptTemplate.from_template(prompt_str)
    model = ChatOpenAI(temperature=0.1)
    # model = ChatOpenAI(model='gpt-4')
    chain = prompt | model
    res = chain.invoke({
        "background": transcript_text,
    })
    return res.content

if __name__ == "__main__":
    # Example usage
    # Generate a Twitter post with background information
    # item_search1 = "Voter related to revolving funds"
    # # item_search1 = "Pledge of Allegiance"
    # post1 = search_event_from_video(item_search1)
    # print(post1)

    # item_search2 = "What are they discussing"
    # post2 = qa_from_video(item_search2)
    # print(post2)

    # item_search2 = "Anything related to homeless issue?"
    # post2 = qa_from_video(item_search2)
    # print(post2)

    item_search2 = "What's the vote of ronen for ?"
    post2 = qa_from_video(item_search2)
    print(post2)

    # has tag test
    # tags = gen_tags_from_video()
    # print(tags)

    
